"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useLogout = void 0;
const react_1 = require("react");
const constants_js_1 = require("../lib/constants.js");
const getGlobalBasePath_js_1 = require("../lib/getGlobalBasePath.js");
function useLogout() {
    const [error, setError] = (0, react_1.useState)(undefined);
    const [loading, setLoading] = (0, react_1.useState)(false);
    async function logout(redirectUrl) {
        var _a, _b;
        setLoading(true);
        const logoutUrl = `${(0, getGlobalBasePath_js_1.getGlobalBasePath)()}${constants_js_1.FAUST_API_BASE_PATH}/${constants_js_1.LOGOUT_ENDPOINT_PARTIAL_PATH}`;
        // Clear the refresh token from the cookie.
        const res = await fetch(logoutUrl, {
            method: 'POST',
        });
        if (!res.ok) {
            setError(res);
            setLoading(false);
            return;
        }
        const isPreview = (_b = (_a = window === null || window === void 0 ? void 0 : window.location) === null || _a === void 0 ? void 0 : _a.search) === null || _b === void 0 ? void 0 : _b.includes('preview=true');
        if (redirectUrl) {
            window.location.assign(redirectUrl);
        }
        else if (isPreview) {
            window.location.assign('/');
        }
        else {
            window.location.reload();
        }
        setLoading(false);
    }
    return {
        error,
        logout,
        loading,
    };
}
exports.useLogout = useLogout;
