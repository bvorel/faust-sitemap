import { useState } from 'react';
import { FAUST_API_BASE_PATH, LOGOUT_ENDPOINT_PARTIAL_PATH, } from '../lib/constants.js';
import { getGlobalBasePath } from '../lib/getGlobalBasePath.js';
export function useLogout() {
    const [error, setError] = useState(undefined);
    const [loading, setLoading] = useState(false);
    async function logout(redirectUrl) {
        var _a, _b;
        setLoading(true);
        const logoutUrl = `${getGlobalBasePath()}${FAUST_API_BASE_PATH}/${LOGOUT_ENDPOINT_PARTIAL_PATH}`;
        // Clear the refresh token from the cookie.
        const res = await fetch(logoutUrl, {
            method: 'POST',
        });
        if (!res.ok) {
            setError(res);
            setLoading(false);
            return;
        }
        const isPreview = (_b = (_a = window === null || window === void 0 ? void 0 : window.location) === null || _a === void 0 ? void 0 : _a.search) === null || _b === void 0 ? void 0 : _b.includes('preview=true');
        if (redirectUrl) {
            window.location.assign(redirectUrl);
        }
        else if (isPreview) {
            window.location.assign('/');
        }
        else {
            window.location.reload();
        }
        setLoading(false);
    }
    return {
        error,
        logout,
        loading,
    };
}
